let con;_bcd‍.x([["getProducts",()=>getProducts],["getCartProducts",()=>getCartProducts],["getProduct",()=>getProduct],["addProduct",()=>addProduct],["updateProduct",()=>updateProduct],["restoreProduct",()=>restoreProduct],["removeProduct",()=>removeProduct]]);_bcd‍.w("../sqlConnect",[["con",["con"],function(v){con=v}]]);

       function getProducts(req, res) {
    let isDeleted = 0;

    if (req.query.deleted) {
        isDeleted = 1;
    }

    con.query("SELECT * FROM `products` WHERE `isDeleted` = ?", [isDeleted], (err, result) => {
        if (err) {
            _bcd‍.g.console.log(err);
        }

        res.send(result);
    });
}

       function getCartProducts(req, res) {
    con.query("SELECT * FROM `products` WHERE `isDeleted` = 0 AND `id` IN (?)", [req.body.cart], (err, result) => {
        if (err) {
            _bcd‍.g.console.log(err);
        }

        res.send(result);
    });
}

       function getProduct(req, res) {
    con.query("SELECT * FROM `products` WHERE `id` = ?", [req.params.id], (err, result) => {
        if (err) {
            _bcd‍.g.console.log(err);
        }

        if (result.length) {
            res.send(result[0]);
        } else {
            res.send();
        }
    });
}

       function addProduct(req, res) {
    con.query("INSERT INTO `products`(`name`, `price`, `discount`) VALUES (?, ?, ?)", [req.body.name, req.body.price, req.body.discount], (err, result) => {
        if (err) {
            _bcd‍.g.console.log(err);
        }
    
        con.query("SELECT * FROM `products` WHERE `id` = ?", [result.insertId], (err, result) => {
            if (err) {
                _bcd‍.g.console.log(err);
            }
            
            res.send(result[0]);
        });
    });
}

       function updateProduct(req, res) {
    con.query("UPDATE `products` SET `name` = ?, `price` = ?, `discount` = ? WHERE `id` = ?", [req.body.name, req.body.price, req.body.discount, req.params.id], (err, result) => {
        if (err) {
            _bcd‍.g.console.log(err);
        }

        res.send();
    });
}

       function restoreProduct(req, res) {
    con.query("UPDATE `products` SET `isDeleted` = 0 WHERE `id` = ?", [req.params.id], (err, result) => {
        if (err) {
            _bcd‍.g.console.log(err);
        }

        res.send();
    });
}

       function removeProduct(req, res) {
    con.query("UPDATE `products` SET `isDeleted` = 1 WHERE `id` = ?", [req.params.id], (err, result) => {
        if (err) {
            _bcd‍.g.console.log(err);
        }

        res.send();
    });
}